################################################################################
#
#  Copyright 2007-2015 Jeffrey Newman.
#
#  This file is part of Larch.
#
#  Larch is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  Larch is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with Larch.  If not, see <http://www.gnu.org/licenses/>.
#
################################################################################
#
#  This example file shows commands needed to replicate the models given in 
#  the Field Guide to Discrete Choice Models.
#
################################################################################

from .. import larch

def data():
	# Define which data set to use with this example.
	return larch.DB.Example('MTC')

def model(d=None): # Define a function to create a data object.
	m = larch.Model.loads("# saved at 12:43:08 PM CDT on 07 Aug 2015\nself.title = '''Pre-Estimated Example Model'''\n\nself.parameter('ASC_SR2',float.fromhex('-0x1.16c9fd4c2115fp+1'),0,0,inf,-inf,float.fromhex('0x1.ac98cf57e0cp-4'),float.fromhex('0x1.ca6962f6e8a26p-4'),0,covariance={'ASC_TRAN': 0.003630723136143545, 'totcost': 3.932247069465609e-06, 'hhinc#6': -2.8974998352788874e-05, 'hhinc#5': -2.6621453996858456e-05, 'hhinc#2': -0.00013854061514278606, 'ASC_BIKE': 0.003075651219905862, 'ASC_SR2': 0.010949093969173153, 'ASC_SR3P': 0.0032655592030293844, 'hhinc#3': -2.997109558887044e-05, 'tottime': -4.309531940399732e-05, 'ASC_WALK': 0.0038647972336481647, 'hhinc#4': -2.996247842631646e-05},robust_covariance={'ASC_TRAN': 0.003327501048038275, 'totcost': 5.855606188460091e-06, 'hhinc#6': -3.05257818644215e-05, 'hhinc#5': -2.794922038193055e-05, 'hhinc#2': -0.0001581290671663348, 'ASC_BIKE': 0.0037266015598201104, 'ASC_SR2': 0.012525394906153035, 'ASC_SR3P': 0.004638396719262653, 'hhinc#3': -4.3899309591380785e-05, 'tottime': -6.210846588362504e-05, 'ASC_WALK': 0.004538215680528513, 'hhinc#4': -2.3697466019031274e-05})\nself.parameter('ASC_SR3P',float.fromhex('-0x1.dcd12ec42d127p+1'),0,0,inf,-inf,float.fromhex('0x1.6be9f2a4e7e74p-3'),float.fromhex('0x1.8b0d362aa5285p-3'),0,covariance={'ASC_TRAN': 0.00418335515805652, 'totcost': 7.585874111256032e-06, 'hhinc#6': -2.7551858642510335e-05, 'hhinc#5': -2.4084992391344738e-05, 'hhinc#2': -3.0169938565167353e-05, 'ASC_BIKE': 0.0034303232445388816, 'ASC_SR2': 0.0032655592030293844, 'ASC_SR3P': 0.0315745583911824, 'hhinc#3': -0.00038412840210520094, 'tottime': -5.2869077453230744e-05, 'ASC_WALK': 0.004338611997655039, 'hhinc#4': -3.036310457716228e-05},robust_covariance={'ASC_TRAN': 0.0035256430665730897, 'totcost': 8.983217991374484e-06, 'hhinc#6': -3.284006620501269e-05, 'hhinc#5': -2.6991123442813073e-05, 'hhinc#2': -4.576459442551793e-05, 'ASC_BIKE': 0.004429552879226894, 'ASC_SR2': 0.004638396719262653, 'ASC_SR3P': 0.037208979797092326, 'hhinc#3': -0.0004709755928416994, 'tottime': -8.194992240004881e-05, 'ASC_WALK': 0.005584013628897955, 'hhinc#4': -1.8742832979519102e-05})\nself.parameter('ASC_TRAN',float.fromhex('-0x1.5789c9a5945f1p-1'),0,0,inf,-inf,float.fromhex('0x1.0f8bf4caf655cp-3'),float.fromhex('0x1.0780097dc3295p-3'),0,covariance={'ASC_TRAN': 0.01758041678641601, 'totcost': 1.428233998244707e-06, 'hhinc#6': -6.172300878581735e-05, 'hhinc#5': -4.397041705587484e-05, 'hhinc#2': -3.3433770738604845e-05, 'ASC_BIKE': 0.006232781222120086, 'ASC_SR2': 0.003630723136143545, 'ASC_SR3P': 0.00418335515805652, 'hhinc#3': -3.662589550186098e-05, 'tottime': -0.00019886965693922704, 'ASC_WALK': 0.010700873853639803, 'hhinc#4': -0.00017992165408077016},robust_covariance={'ASC_TRAN': 0.016553956585612328, 'totcost': 1.0228184936067422e-06, 'hhinc#6': -8.070303250638642e-05, 'hhinc#5': -5.267239924856869e-05, 'hhinc#2': -2.807997721468187e-05, 'ASC_BIKE': 0.007448929357386533, 'ASC_SR2': 0.003327501048038275, 'ASC_SR3P': 0.0035256430665730897, 'hhinc#3': -2.5801326556222776e-05, 'tottime': -0.0002337684791824573, 'ASC_WALK': 0.012794908225955366, 'hhinc#4': -0.00017199307783048013})\nself.parameter('ASC_BIKE',float.fromhex('-0x1.302c02f1cf924p+1'),0,0,inf,-inf,float.fromhex('0x1.37cf69ba1d95bp-2'),float.fromhex('0x1.715974b4caaa9p-2'),0,covariance={'ASC_TRAN': 0.006232781222120086, 'totcost': 5.055447729649417e-06, 'hhinc#6': -5.849354493459856e-05, 'hhinc#5': -0.0013970933330124317, 'hhinc#2': -2.6480592951764468e-05, 'ASC_BIKE': 0.09272156257580551, 'ASC_SR2': 0.003075651219905862, 'ASC_SR3P': 0.0034303232445388816, 'hhinc#3': -2.3813064588467753e-05, 'tottime': -0.00012355007207539732, 'ASC_WALK': 0.008398400631255317, 'hhinc#4': -4.1280262922966464e-05},robust_covariance={'ASC_TRAN': 0.007448929357386533, 'totcost': 7.311870733745283e-06, 'hhinc#6': -6.192158320684402e-05, 'hhinc#5': -0.0021244213598252347, 'hhinc#2': -2.888586247698464e-05, 'ASC_BIKE': 0.13009930290781765, 'ASC_SR2': 0.0037266015598201104, 'ASC_SR3P': 0.004429552879226894, 'hhinc#3': -2.8650304201177488e-05, 'tottime': -0.00018120612571458279, 'ASC_WALK': 0.010564876025675466, 'hhinc#4': -5.055241398249063e-05})\nself.parameter('ASC_WALK',float.fromhex('-0x1.a78de88a2de72p-3'),0,0,inf,-inf,float.fromhex('0x1.8d8427899c5dfp-3'),float.fromhex('0x1.a7396ce144561p-3'),0,covariance={'ASC_TRAN': 0.010700873853639803, 'totcost': 4.224423499067083e-06, 'hhinc#6': -0.0004356745328913158, 'hhinc#5': -5.300256244706007e-05, 'hhinc#2': -2.74635660286338e-05, 'ASC_BIKE': 0.008398400631255317, 'ASC_SR2': 0.0038647972336481647, 'ASC_SR3P': 0.004338611997655039, 'hhinc#3': -2.4881167656007954e-05, 'tottime': -0.0002922688563430644, 'ASC_WALK': 0.03767470163295171, 'hhinc#4': -5.298118448542414e-05},robust_covariance={'ASC_TRAN': 0.012794908225955366, 'totcost': 4.75425613696173e-06, 'hhinc#6': -0.0004911851629451555, 'hhinc#5': -5.767993368035626e-05, 'hhinc#2': -3.137385659237937e-05, 'ASC_BIKE': 0.010564876025675466, 'ASC_SR2': 0.004538215680528513, 'ASC_SR3P': 0.005584013628897955, 'hhinc#3': -3.598039549494508e-05, 'tottime': -0.00039480214835842096, 'ASC_WALK': 0.04270525527719047, 'hhinc#4': -7.229473541922347e-05})\nself.parameter('hhinc#2',float.fromhex('-0x1.1c6d2c8ef629p-9'),0,0,inf,-inf,float.fromhex('0x1.972f6026eed19p-10'),float.fromhex('0x1.afaee626e93a2p-10'),0,covariance={'ASC_TRAN': -3.3433770738604845e-05, 'totcost': 1.2553291724271225e-08, 'hhinc#6': 4.288618138289284e-07, 'hhinc#5': 4.392200793728478e-07, 'hhinc#2': 2.4127027984913333e-06, 'ASC_BIKE': -2.6480592951764468e-05, 'ASC_SR2': -0.00013854061514278606, 'ASC_SR3P': -3.0169938565167353e-05, 'hhinc#3': 5.166418713933516e-07, 'tottime': 1.7652056788264004e-08, 'ASC_WALK': -2.74635660286338e-05, 'hhinc#4': 5.434491364585326e-07},robust_covariance={'ASC_TRAN': -2.807997721468187e-05, 'totcost': 7.233602405602784e-09, 'hhinc#6': 4.513273185246945e-07, 'hhinc#5': 4.279113490722721e-07, 'hhinc#2': 2.711754999372019e-06, 'ASC_BIKE': -2.888586247698464e-05, 'ASC_SR2': -0.0001581290671663348, 'ASC_SR3P': -4.576459442551793e-05, 'hhinc#3': 7.294269381486953e-07, 'tottime': 1.3919729444746822e-07, 'ASC_WALK': -3.137385659237937e-05, 'hhinc#4': 3.888678097061543e-07})\nself.parameter('hhinc#3',float.fromhex('0x1.77079ade39593p-12'),0,0,inf,-inf,float.fromhex('0x1.4ca014b90a08fp-9'),float.fromhex('0x1.6fd30fa62b593p-9'),0,covariance={'ASC_TRAN': -3.662589550186098e-05, 'totcost': 2.5998474844029178e-08, 'hhinc#6': 4.0398205700462395e-07, 'hhinc#5': 4.202594677394476e-07, 'hhinc#2': 5.166418713933516e-07, 'ASC_BIKE': -2.3813064588467753e-05, 'ASC_SR2': -2.997109558887044e-05, 'ASC_SR3P': -0.00038412840210520094, 'hhinc#3': 6.4400723774720045e-06, 'tottime': 3.057346301515247e-08, 'ASC_WALK': -2.4881167656007954e-05, 'hhinc#4': 6.352501670607664e-07},robust_covariance={'ASC_TRAN': -2.5801326556222776e-05, 'totcost': 3.759384449888228e-08, 'hhinc#6': 5.169621771059686e-07, 'hhinc#5': 4.395851184184427e-07, 'hhinc#2': 7.294269381486953e-07, 'ASC_BIKE': -2.8650304201177488e-05, 'ASC_SR2': -4.3899309591380785e-05, 'ASC_SR3P': -0.0004709755928416994, 'hhinc#3': 7.875195678898203e-06, 'tottime': 2.702563696621218e-07, 'ASC_WALK': -3.598039549494508e-05, 'hhinc#4': 3.2634056733176374e-07})\nself.parameter('hhinc#4',float.fromhex('-0x1.5a745d8d634eap-8'),0,0,inf,-inf,float.fromhex('0x1.df6a398bafc7bp-10'),float.fromhex('0x1.cfc42810517b5p-10'),0,covariance={'ASC_TRAN': -0.00017992165408077016, 'totcost': 4.715976251306663e-08, 'hhinc#6': 9.213680488723025e-07, 'hhinc#5': 7.933193528905565e-07, 'hhinc#2': 5.434491364585326e-07, 'ASC_BIKE': -4.1280262922966464e-05, 'ASC_SR2': -2.996247842631646e-05, 'ASC_SR3P': -3.036310457716228e-05, 'hhinc#3': 6.352501670607664e-07, 'tottime': -2.4566754100872934e-08, 'ASC_WALK': -5.298118448542414e-05, 'hhinc#4': 3.3445930639340034e-06},robust_covariance={'ASC_TRAN': -0.00017199307783048013, 'totcost': 2.6637340403240012e-08, 'hhinc#6': 1.2056653005733903e-06, 'hhinc#5': 9.153993289108544e-07, 'hhinc#2': 3.888678097061543e-07, 'ASC_BIKE': -5.055241398249063e-05, 'ASC_SR2': -2.3697466019031274e-05, 'ASC_SR3P': -1.8742832979519102e-05, 'hhinc#3': 3.2634056733176374e-07, 'tottime': 2.0440079424413903e-07, 'ASC_WALK': -7.229473541922347e-05, 'hhinc#4': 3.1298131500708604e-06})\nself.parameter('hhinc#5',float.fromhex('-0x1.a3b1ba3a4712fp-7'),0,0,inf,-inf,float.fromhex('0x1.5ceb39fe2bf48p-8'),float.fromhex('0x1.ae3eb88164dedp-8'),0,covariance={'ASC_TRAN': -4.397041705587484e-05, 'totcost': 1.329432793393663e-08, 'hhinc#6': 9.751201894330238e-07, 'hhinc#5': 2.8345819197823692e-05, 'hhinc#2': 4.392200793728478e-07, 'ASC_BIKE': -0.0013970933330124317, 'ASC_SR2': -2.6621453996858456e-05, 'ASC_SR3P': -2.4084992391344738e-05, 'hhinc#3': 4.202594677394476e-07, 'tottime': -1.1894364811708185e-07, 'ASC_WALK': -5.300256244706007e-05, 'hhinc#4': 7.933193528905565e-07},robust_covariance={'ASC_TRAN': -5.267239924856869e-05, 'totcost': 2.3315247104704082e-08, 'hhinc#6': 9.932689813385435e-07, 'hhinc#5': 4.30994579707982e-05, 'hhinc#2': 4.279113490722721e-07, 'ASC_BIKE': -0.0021244213598252347, 'ASC_SR2': -2.794922038193055e-05, 'ASC_SR3P': -2.6991123442813073e-05, 'hhinc#3': 4.395851184184427e-07, 'tottime': -4.272919687774947e-09, 'ASC_WALK': -5.767993368035626e-05, 'hhinc#4': 9.153993289108544e-07})\nself.parameter('hhinc#6',float.fromhex('-0x1.3d6644d6867e9p-7'),0,0,inf,-inf,float.fromhex('0x1.8d8c1b5610449p-9'),float.fromhex('0x1.a73446ed34d74p-9'),0,covariance={'ASC_TRAN': -6.172300878581735e-05, 'totcost': -3.643998043320145e-10, 'hhinc#6': 9.199362799387444e-06, 'hhinc#5': 9.751201894330238e-07, 'hhinc#2': 4.288618138289284e-07, 'ASC_BIKE': -5.849354493459856e-05, 'ASC_SR2': -2.8974998352788874e-05, 'ASC_SR3P': -2.7551858642510335e-05, 'hhinc#3': 4.0398205700462395e-07, 'tottime': 1.5337830074347855e-07, 'ASC_WALK': -0.0004356745328913158, 'hhinc#4': 9.213680488723025e-07},robust_covariance={'ASC_TRAN': -8.070303250638642e-05, 'totcost': 1.687929623711101e-08, 'hhinc#6': 1.042509690377335e-05, 'hhinc#5': 9.932689813385435e-07, 'hhinc#2': 4.513273185246945e-07, 'ASC_BIKE': -6.192158320684402e-05, 'ASC_SR2': -3.05257818644215e-05, 'ASC_SR3P': -3.284006620501269e-05, 'hhinc#3': 5.169621771059686e-07, 'tottime': 5.16897893413004e-07, 'ASC_WALK': -0.0004911851629451555, 'hhinc#4': 1.2056653005733903e-06})\nself.parameter('tottime',float.fromhex('-0x1.a494af98b5f21p-5'),0,0,inf,-inf,float.fromhex('0x1.963ed8001eb4fp-9'),float.fromhex('0x1.c4da3e5feac6cp-9'),0,covariance={'ASC_TRAN': -0.00019886965693922704, 'totcost': 1.631685375720094e-08, 'hhinc#6': 1.5337830074347855e-07, 'hhinc#5': -1.1894364811708185e-07, 'hhinc#2': 1.7652056788264004e-08, 'ASC_BIKE': -0.00012355007207539732, 'ASC_SR2': -4.309531940399732e-05, 'ASC_SR3P': -5.2869077453230744e-05, 'hhinc#3': 3.057346301515247e-08, 'tottime': 9.606324182092157e-06, 'ASC_WALK': -0.0002922688563430644, 'hhinc#4': -2.4566754100872934e-08},robust_covariance={'ASC_TRAN': -0.0002337684791824573, 'totcost': 2.2140553111159647e-08, 'hhinc#6': 5.16897893413004e-07, 'hhinc#5': -4.272919687774947e-09, 'hhinc#2': 1.3919729444746822e-07, 'ASC_BIKE': -0.00018120612571458279, 'ASC_SR2': -6.210846588362504e-05, 'ASC_SR3P': -8.194992240004881e-05, 'hhinc#3': 2.702563696621218e-07, 'tottime': 1.1936959325885326e-05, 'ASC_WALK': -0.00039480214835842096, 'hhinc#4': 2.0440079424413903e-07})\nself.parameter('totcost',float.fromhex('-0x1.4275fe044df72p-8'),0,0,inf,-inf,float.fromhex('0x1.f4ff23f584683p-13'),float.fromhex('0x1.291019e546cf2p-12'),0,covariance={'ASC_TRAN': 1.428233998244707e-06, 'totcost': 5.7070254965251465e-08, 'hhinc#6': -3.643998043320145e-10, 'hhinc#5': 1.329432793393663e-08, 'hhinc#2': 1.2553291724271225e-08, 'ASC_BIKE': 5.055447729649417e-06, 'ASC_SR2': 3.932247069465609e-06, 'ASC_SR3P': 7.585874111256032e-06, 'hhinc#3': 2.5998474844029178e-08, 'tottime': 1.631685375720094e-08, 'ASC_WALK': 4.224423499067083e-06, 'hhinc#4': 4.715976251306663e-08},robust_covariance={'ASC_TRAN': 1.0228184936067422e-06, 'totcost': 8.025960020530882e-08, 'hhinc#6': 1.687929623711101e-08, 'hhinc#5': 2.3315247104704082e-08, 'hhinc#2': 7.233602405602784e-09, 'ASC_BIKE': 7.311870733745283e-06, 'ASC_SR2': 5.855606188460091e-06, 'ASC_SR3P': 8.983217991374484e-06, 'hhinc#3': 3.759384449888228e-08, 'tottime': 2.2140553111159647e-08, 'ASC_WALK': 4.75425613696173e-06, 'hhinc#4': 2.6637340403240012e-08})\n\n\nself.utility.ca('''tottime''','''tottime''',1)\nself.utility.ca('''totcost''','''totcost''',1)\nself.utility.co(2,'''1''','''ASC_SR2''',1)\nself.utility.co(2,'''hhinc''','''hhinc#2''',1)\nself.utility.co(3,'''1''','''ASC_SR3P''',1)\nself.utility.co(3,'''hhinc''','''hhinc#3''',1)\nself.utility.co(4,'''1''','''ASC_TRAN''',1)\nself.utility.co(4,'''hhinc''','''hhinc#4''',1)\nself.utility.co(5,'''1''','''ASC_BIKE''',1)\nself.utility.co(5,'''hhinc''','''hhinc#5''',1)\nself.utility.co(6,'''1''','''ASC_WALK''',1)\nself.utility.co(6,'''hhinc''','''hhinc#6''',1)\n\n\nself.root_id = 0\n\nself._set_estimation_statistics(float.fromhex('-0x1.c545f5ccd78dp+11'),float.fromhex('-0x1.c8d99d948dab4p+12'),nan,nan,float.fromhex('-0x1.c545f5ccd78dp+11'))\nself._set_estimation_run_statistics(1438969365,540980,1438969366,31972,11,'''success''','''autoscaled weights 1\n''')\n\nself.option.threads= 4\nself.option.calc_null_likelihood= True\nself.option.null_disregards_holdfast=True\nself.option.calc_std_errors= True\nself.option.gradient_diagnostic= 0\nself.option.hessian_diagnostic= 0\nself.option.mute_nan_warnings= True\nself.option.force_finite_diff_grad= False\nself.option.force_recalculate= False\nself.option.save_db_hash= False\nself.option.author= 'Chuck Finley'\nself.option.teardown_after_estimate= True\nself.weight_autorescale= True\nself.suspend_xylem_rebuild= False\nself.log_turns= False\n\nimport pickle\n\nself.descriptions = pickle.loads(b'\\x80\\x03clarch.utilities\\ndicta\\nq\\x00)\\x81q\\x01.')\nself.recall(nCases=5029)")
	return m

############################# END OF EXAMPLE FILE ##############################

