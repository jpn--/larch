
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Choice Models &#8212; v5.6.2.dev22+gcb35445c</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/larch-book.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/larch_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data for Discrete Choice" href="data-fundamentals.html" />
    <link rel="prev" title="Installing Larch" href="../installation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="32x32" href="../_static/img/larch_favicon.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/larch-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">v5.6.2.dev22+gcb35445c</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search these docs..." aria-label="Search these docs..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Users Guide
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installing Larch
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   Choice Models
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="data-fundamentals.html">
     Data Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear-funcs.html">
     Linear Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="machine-learning.html">
     Machine Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bibliography.html">
   References
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/~data.html">
   Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/dataset.html">
     Dataset
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.html">
       larch.Dataset
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.construct.html">
       larch.Dataset.construct
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.dims.html">
       larch.Dataset.dims
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.sizes.html">
       larch.Dataset.sizes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.data_vars.html">
       larch.Dataset.data_vars
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.coords.html">
       larch.Dataset.coords
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.attrs.html">
       larch.Dataset.attrs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.encoding.html">
       larch.Dataset.encoding
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.indexes.html">
       larch.Dataset.indexes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.chunks.html">
       larch.Dataset.chunks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.chunksizes.html">
       larch.Dataset.chunksizes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.nbytes.html">
       larch.Dataset.nbytes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.Dataset.set_dtypes.html">
       larch.Dataset.set_dtypes
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/datatree.html">
     DataTree
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.html">
       larch.DataTree
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.root_node_name.html">
       larch.DataTree.root_node_name
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.subspaces.html">
       larch.DataTree.subspaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.relationships_are_digitized.html">
       larch.DataTree.relationships_are_digitized
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.n_cases.html">
       larch.DataTree.n_cases
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.n_alts.html">
       larch.DataTree.n_alts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.CASEID.html">
       larch.DataTree.CASEID
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.ALTID.html">
       larch.DataTree.ALTID
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.add_dataset.html">
       larch.DataTree.add_dataset
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.add_relationship.html">
       larch.DataTree.add_relationship
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.digitize_relationships.html">
       larch.DataTree.digitize_relationships
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.query_cases.html">
       larch.DataTree.query_cases
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.replace_datasets.html">
       larch.DataTree.replace_datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataTree.setup_flow.html">
       larch.DataTree.setup_flow
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/dataframes.html">
     DataFrames
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.DataFrames.html">
       larch.DataFrames
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/~models.html">
   Models
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/model.html">
     Model
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.html">
       larch.numba.Model
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.datatree.html">
       larch.numba.Model.datatree
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.dataset.html">
       larch.numba.Model.dataset
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.n_cases.html">
       larch.numba.Model.n_cases
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.choice_ca_var.html">
       larch.numba.Model.choice_ca_var
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.choice_co_vars.html">
       larch.numba.Model.choice_co_vars
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.choice_co_code.html">
       larch.numba.Model.choice_co_code
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.availability_ca_var.html">
       larch.numba.Model.availability_ca_var
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.availability_co_vars.html">
       larch.numba.Model.availability_co_vars
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.utility_ca.html">
       larch.numba.Model.utility_ca
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.utility_co.html">
       larch.numba.Model.utility_co
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.quantity_ca.html">
       larch.numba.Model.quantity_ca
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.pf.html">
       larch.numba.Model.pf
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.most_recent_estimation_result.html">
       larch.numba.Model.most_recent_estimation_result
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.possible_overspecification.html">
       larch.numba.Model.possible_overspecification
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.set_values.html">
       larch.numba.Model.set_values
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.lock_value.html">
       larch.numba.Model.lock_value
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.set_cap.html">
       larch.numba.Model.set_cap
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.remove_unused_parameters.html">
       larch.numba.Model.remove_unused_parameters
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.maximize_loglike.html">
       larch.numba.Model.maximize_loglike
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.calculate_parameter_covariance.html">
       larch.numba.Model.calculate_parameter_covariance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.loglike_nil.html">
       larch.numba.Model.loglike_nil
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.loglike_null.html">
       larch.numba.Model.loglike_null
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.rho_sq_nil.html">
       larch.numba.Model.rho_sq_nil
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.rho_sq_null.html">
       larch.numba.Model.rho_sq_null
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.parameter_summary.html">
       larch.numba.Model.parameter_summary
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.estimation_statistics.html">
       larch.numba.Model.estimation_statistics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.to_xlsx.html">
       larch.numba.Model.to_xlsx
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.bhhh.html">
       larch.numba.Model.bhhh
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.check_d_loglike.html">
       larch.numba.Model.check_d_loglike
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.d_loglike.html">
       larch.numba.Model.d_loglike
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.d_loglike_casewise.html">
       larch.numba.Model.d_loglike_casewise
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.loglike.html">
       larch.numba.Model.loglike
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.loglike_casewise.html">
       larch.numba.Model.loglike_casewise
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.logsums.html">
       larch.numba.Model.logsums
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.probability.html">
       larch.numba.Model.probability
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.quantity.html">
       larch.numba.Model.quantity
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.total_weight.html">
       larch.numba.Model.total_weight
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.numba.Model.utility.html">
       larch.numba.Model.utility
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/linear.html">
     Linear Functions
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/nesting.html">
     NestingTree
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.html">
       larch.model.tree.NestingTree
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.new_node.html">
       larch.model.tree.NestingTree.new_node
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.add_node.html">
       larch.model.tree.NestingTree.add_node
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.remove_node.html">
       larch.model.tree.NestingTree.remove_node
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.add_edge.html">
       larch.model.tree.NestingTree.add_edge
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.remove_edge.html">
       larch.model.tree.NestingTree.remove_edge
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/modelgroup.html">
     ModelGroup
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
    <label for="toctree-checkbox-9">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.html">
       larch.model.model_group.ModelGroup
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.n_cases.html">
       larch.model.model_group.ModelGroup.n_cases
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.set_values.html">
       larch.model.model_group.ModelGroup.set_values
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.total_weight.html">
       larch.model.model_group.ModelGroup.total_weight
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.loglike.html">
       larch.model.model_group.ModelGroup.loglike
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.loglike2.html">
       larch.model.model_group.ModelGroup.loglike2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/generated/larch.model.model_group.ModelGroup.to_xlsx.html">
       larch.model.model_group.ModelGroup.to_xlsx
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../example/mtc.html">
   MTC Mode Choice
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/000_mtc_data.html">
     MTC Work Mode Choice Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/001_mnl.html">
     1: MTC MNL Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/002_mtc.html">
     2: MTC MNL Mode Choice, Motorized
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/017A_mnl_segmented.html">
     17a: Market Segmentatation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/017_mnl_final.html">
     17: MTC Expanded MNL Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/022-nl.html">
     22: MTC Motorized and Non-Motorized Nested Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/028-nl.html">
     28: MTC Motorized - Shared Ride - Non-Motorized Nested Mode Choice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../example/swissmetro.html">
   Swissmetro
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/101_swissmetro_mnl.html">
     101: Swissmetro MNL Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/102-swissmetro-weighted.html">
     102: Swissmetro Weighted MNL Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/109-swissmetro-nl.html">
     109: Swissmetro Nested Logit Mode Choice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../example/exampville.html">
   Exampville
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/200_exampville.html">
     200: Exampville Simulated Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/201_exville_mode_choice.html">
     201: Exampville Mode Choice
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/202_exville_mc_logsums.html">
     202: Exampville Mode Choice Logsums
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/203_exville_dest.html">
     203: Exampville Destination Choice
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../example/itinerary.html">
   Itinerary Choice
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/300_itinerary.html">
     300: Itinerary Choice Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../example/301_itin_mnl.html">
     301: Itinerary Choice using MNL
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../example/legacy.html">
   Legacy Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../example/legacy/mtc.html">
     MTC Mode Choice Examples
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/000_mtc_data.html">
       MTC Work Mode Choice Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/001.mtc.html">
       1: MTC MNL Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/002_mtc.html">
       2: MTC MNL Mode Choice, Motorized
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/003_mtc.html">
       3: MTC MNL Mode Choice, Zeroed Shared
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/005_mtc.html">
       5: MTC MNL Mode Choice, Motorized Travel Time
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/006_mtc.html">
       6: MTC MNL Mode Choice, Motorized Times
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/007_mtc.html">
       7: MTC MNL Mode Choice, Diminishing OVTT by Distance
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/008_mtc.html">
       8: MTC MNL Mode Choice, TTR = 2.5
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/009_mtc.html">
       9: MTC MNL Mode Choice, TTR = 4.0
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/010_mtc.html">
       10: MTC MNL Mode Choice, Autos per Household
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/011_mtc.html">
       11: MTC MNL Mode Choice, Vehicle by Worker
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/012_mtc.html">
       12: MTC MNL Mode Choice, Autos per Adult
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/013_mtc.html">
       13: MTC MNL Mode Choice, CBD
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/014_mtc.html">
       14: MTC MNL Mode Choice, Work Zone Density
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/015_mtc.html">
       15: MTC MNL Mode Choice, CBD and Work Zone Density
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/016_mtc.html">
       16: MTC MNL Mode Choice, Cost by Income
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/017A_mtc.html">
       17A: MTC MNL Mode Choice, Segmented for 1 or fewer cars
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/017B_mtc.html">
       17B: MTC MNL Mode Choice, Segmented for 2 or more cars
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/017C_mtc.html">
       17C: MTC MNL Mode Choice, Segmented for Males
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/017D_mtc.html">
       17D: MTC MNL Mode Choice, Segmented for Females
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/017_mtc.html">
       17: MTC Expanded MNL Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/018_mtc.html">
       18: MTC Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/019_mtc.html">
       19: MTC Private Auto Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/020_mtc.html">
       20: MTC Shared Ride Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/021_mtc.html">
       21: MTC Non-Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/022_mtc.html">
       22: MTC Motorized and Non-Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/023_mtc.html">
       23W: MTC Private Auto - Non-Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/024_mtc.html">
       23W: MTC Shared Ride - Non-Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/025_mtc.html">
       25: MTC Private Auto - Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/026_mtc.html">
       26: MTC Shared Ride - Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/027_mtc.html">
       27: MTC Shared Ride - Private Auto Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/028_mtc.html">
       28: MTC Motorized - Shared Ride - Non-Motorized Nested Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/029_mtc.html">
       29: MTC Motorized - Shared Ride - Private Auto Nested Mode Choice
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../example/legacy/swissmetro.html">
     Swissmetro Examples
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/101_mnl.html">
       101: Swissmetro MNL Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/102_mnl_weighted.html">
       102: Swissmetro Weighted MNL Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/107_latent_class.html">
       107: Latent Class Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/109_nl.html">
       109: Swissmetro Nested Logit Mode Choice
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/111_cnl.html">
       111: Swissmetro Cross-Nested Logit Mode Choice
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../example/legacy/itinerary.html">
     Itinerary Choice Examples
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/300L_itinerary.html">
       300L: Itinerary Choice Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/301_itin_mnl.html">
       301: Itinerary Choice using MNL
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../example/legacy/302_itin_nl.html">
       302: Itinerary Choice using Simple Nested Logit
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/user-guide/choice-models.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/jpn--/larch"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/jpn--/larch/issues/new?title=Issue%20on%20page%20%2Fuser-guide/choice-models.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choices">
   Choices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#availability">
   Availability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utility-functions">
   Utility Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data Preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nesting-structures">
   Nesting Structures
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameter-estimation">
   Parameter Estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reporting">
   Reporting
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Choice Models</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choices">
   Choices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#availability">
   Availability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#utility-functions">
   Utility Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data Preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nesting-structures">
   Nesting Structures
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameter-estimation">
   Parameter Estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reporting">
   Reporting
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="choice-models">
<h1>Choice Models<a class="headerlink" href="#choice-models" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">larch.numba</span> <span class="k">as</span> <span class="nn">lx</span>
</pre></div>
</div>
</div>
</div>
<p>In this guide, we’ll take a look at building a discrete choice model using Larch.
We assume you have a decent grasp of the fundamentals of choice modeling – if not,
we suggest reading the
<a class="reference external" href="https://pytransport.github.io/course-content/choice-modeling/_index.html">Discrete Choice Modeling</a>
section of the <a class="reference external" href="https://pytransport.github.io">Python for Transportation Modeling</a> course.</p>
<p>Some addition advanced or detailed topics are broken out into seperate guides:</p>
<ul class="simple">
<li><p><a class="reference internal" href="data-fundamentals.html#data-fundamentals"><span class="std std-ref">Data Fundamentals for Choice Models</span></a></p></li>
<li><p><a class="reference internal" href="linear-funcs.html#linear-funcs"><span class="std std-ref">Working with Linear Functions</span></a></p></li>
<li><p><a class="reference internal" href="machine-learning.html"><span class="doc std std-doc">Machine Learning Integration</span></a></p></li>
</ul>
<p>The examples below work with the tiny dataset introduced in the
<a class="reference internal" href="data-fundamentals.html#data-fundamentals"><span class="std std-ref">Data Fundamentals</span></a> section.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># HIDDEN</span>
<span class="n">df_ca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;example-data/tiny_idca.csv&quot;</span><span class="p">)</span>
<span class="n">cats</span> <span class="o">=</span> <span class="n">df_ca</span><span class="p">[</span><span class="s1">&#39;altid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">([</span><span class="s1">&#39;Car&#39;</span><span class="p">,</span> <span class="s1">&#39;Bus&#39;</span><span class="p">,</span> <span class="s1">&#39;Walk&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">cat</span>
<span class="n">df_ca</span><span class="p">[</span><span class="s1">&#39;altnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cats</span><span class="o">.</span><span class="n">codes</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">df_ca</span> <span class="o">=</span> <span class="n">df_ca</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;caseid&#39;</span><span class="p">,</span> <span class="s1">&#39;altnum&#39;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">construct</span><span class="o">.</span><span class="n">from_idca</span><span class="p">(</span><span class="n">df_ca</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(),</span> <span class="n">fill_missing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s2">&quot;_avail_&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;ChosenCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Chosen&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Chosen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">altnum</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;altnum&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;alt_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">cats</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;altnum&#39;</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;altnum&#39;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">altnum</span><span class="p">})</span>
<span class="n">alts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;altnum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;alt_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">alts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">altnum</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:     (caseid: 4, altnum: 3)
Coordinates:
  * caseid      (caseid) int64 1 2 3 4
  * altnum      (altnum) int64 1 2 3
    alt_names   (altnum) object &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;
Data variables:
    altid       (caseid, altnum) object &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27; ... &#x27;Bus&#x27; &#x27;Walk&#x27;
    Income      (caseid) int64 30000 30000 40000 50000
    Time        (caseid, altnum) int64 30 40 20 25 35 0 40 50 30 15 20 10
    Cost        (caseid, altnum) int64 150 100 0 125 100 0 125 75 0 225 150 0
    Chosen      (caseid, altnum) int64 1 0 0 0 1 0 0 0 1 0 0 1
    ChosenCode  (caseid) int64 1 2 3 3
    CarTime     (caseid) int64 30 25 40 15
    BusTime     (caseid) int64 40 35 50 20
    WalkTime    (caseid) int64 20 0 30 10
Attributes:
    _caseid_:  caseid
    _altid_:   altnum</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-2588ad59-1d7c-45f7-b087-2c663d101038' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-2588ad59-1d7c-45f7-b087-2c663d101038' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>caseid</span>: 4</li><li><span class='xr-has-index'>altnum</span>: 3</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-027d5e47-0dcf-496f-9896-3070fe02a467' class='xr-section-summary-in' type='checkbox'  checked><label for='section-027d5e47-0dcf-496f-9896-3070fe02a467' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>caseid</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-d1c04063-d28d-4d2d-a5cf-647204ba601f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d1c04063-d28d-4d2d-a5cf-647204ba601f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9517b804-e16f-4e5b-aeb7-31fc1d9da230' class='xr-var-data-in' type='checkbox'><label for='data-9517b804-e16f-4e5b-aeb7-31fc1d9da230' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>altnum</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-e00e115c-123b-489e-a5f6-603c5bf51c4d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e00e115c-123b-489e-a5f6-603c5bf51c4d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d68b8f7c-8a7b-4fb3-8036-a7804d05eb75' class='xr-var-data-in' type='checkbox'><label for='data-d68b8f7c-8a7b-4fb3-8036-a7804d05eb75' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>alt_names</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</div><input id='attrs-f71da764-2018-4e7c-a778-d183724f22b4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f71da764-2018-4e7c-a778-d183724f22b4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8f58c292-aadf-4ddb-8d4a-f4cc0ed486cb' class='xr-var-data-in' type='checkbox'><label for='data-8f58c292-aadf-4ddb-8d4a-f4cc0ed486cb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-67f2ff6d-c6c6-4303-8571-a29845f34599' class='xr-section-summary-in' type='checkbox'  checked><label for='section-67f2ff6d-c6c6-4303-8571-a29845f34599' class='xr-section-summary' >Data variables: <span>(9)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>altid</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27; ... &#x27;Bus&#x27; &#x27;Walk&#x27;</div><input id='attrs-af601f79-3939-456f-b124-6625a1e6ea5c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-af601f79-3939-456f-b124-6625a1e6ea5c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d6821ead-2f59-4ab7-98c9-0f1c05638fa6' class='xr-var-data-in' type='checkbox'><label for='data-d6821ead-2f59-4ab7-98c9-0f1c05638fa6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;],
       [&#x27;Car&#x27;, &#x27;Bus&#x27;, 0],
       [&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;],
       [&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;]], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Income</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>30000 30000 40000 50000</div><input id='attrs-68071594-737c-43fc-8630-66253ecfea96' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-68071594-737c-43fc-8630-66253ecfea96' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-deab564f-67ac-47bc-9cc8-e6b1edb54ea8' class='xr-var-data-in' type='checkbox'><label for='data-deab564f-67ac-47bc-9cc8-e6b1edb54ea8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([30000, 30000, 40000, 50000])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Time</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>30 40 20 25 35 0 40 50 30 15 20 10</div><input id='attrs-f72b3cbe-d876-4bfb-8691-2e55c5620018' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f72b3cbe-d876-4bfb-8691-2e55c5620018' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-03b8c8a7-edf5-4384-842e-cf892ff92a05' class='xr-var-data-in' type='checkbox'><label for='data-03b8c8a7-edf5-4384-842e-cf892ff92a05' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[30, 40, 20],
       [25, 35,  0],
       [40, 50, 30],
       [15, 20, 10]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Cost</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>150 100 0 125 100 ... 0 225 150 0</div><input id='attrs-d18a5a70-eb71-467d-8247-6fefa8dadf51' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d18a5a70-eb71-467d-8247-6fefa8dadf51' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e4344f03-f11f-40a9-a228-ad4834318a4c' class='xr-var-data-in' type='checkbox'><label for='data-e4344f03-f11f-40a9-a228-ad4834318a4c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[150, 100,   0],
       [125, 100,   0],
       [125,  75,   0],
       [225, 150,   0]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>Chosen</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 0 0 0 1 0 0 0 1 0 0 1</div><input id='attrs-73fd7225-005e-4cb6-a8cc-8d889dac2043' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-73fd7225-005e-4cb6-a8cc-8d889dac2043' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c5f08f4a-7da6-4f23-aa50-0e8888788ef7' class='xr-var-data-in' type='checkbox'><label for='data-c5f08f4a-7da6-4f23-aa50-0e8888788ef7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1, 0, 0],
       [0, 1, 0],
       [0, 0, 1],
       [0, 0, 1]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ChosenCode</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 3</div><input id='attrs-f06b8eca-4772-4b8e-bfec-05b4c1f88530' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f06b8eca-4772-4b8e-bfec-05b4c1f88530' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-aa062672-5486-43db-98b4-b55cd9523b6c' class='xr-var-data-in' type='checkbox'><label for='data-aa062672-5486-43db-98b4-b55cd9523b6c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>CarTime</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>30 25 40 15</div><input id='attrs-81c12e8b-422f-41f0-b7d9-c3b02e30a804' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-81c12e8b-422f-41f0-b7d9-c3b02e30a804' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6e5c3127-4390-44e0-9cb4-d5bdfa249c59' class='xr-var-data-in' type='checkbox'><label for='data-6e5c3127-4390-44e0-9cb4-d5bdfa249c59' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([30, 25, 40, 15])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>BusTime</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>40 35 50 20</div><input id='attrs-4ee7d5e1-9909-4af1-bd7e-91b554be6b4c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4ee7d5e1-9909-4af1-bd7e-91b554be6b4c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ef1edde7-8ff3-407a-951f-a83738135ea4' class='xr-var-data-in' type='checkbox'><label for='data-ef1edde7-8ff3-407a-951f-a83738135ea4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([40, 35, 50, 20])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>WalkTime</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>20 0 30 10</div><input id='attrs-165e176f-ba2f-4698-a315-e7376a3f70e2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-165e176f-ba2f-4698-a315-e7376a3f70e2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d0efa823-4b69-4c54-ac89-0d549b5a244c' class='xr-var-data-in' type='checkbox'><label for='data-d0efa823-4b69-4c54-ac89-0d549b5a244c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([20,  0, 30, 10])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4bdbcfed-c39a-41f4-979e-b55e1493bc6d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-4bdbcfed-c39a-41f4-979e-b55e1493bc6d' class='xr-section-summary' >Attributes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>_caseid_ :</span></dt><dd>caseid</dd><dt><span>_altid_ :</span></dt><dd>altnum</dd></dl></div></li></ul></div></div></div></div>
</div>
<p>The basic structure of a choice model in Larch is contained in the
<a class="reference internal" href="../api/generated/larch.numba.Model.html#larch.numba.Model" title="larch.numba.Model"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">Model</span></code></span></a> object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="choices">
<h2>Choices<a class="headerlink" href="#choices" title="Permalink to this headline">¶</a></h2>
<p>The dependent variable for a discrete choice model is an array that describes the choices.
In Larch, there are three different ways to indicate choices, by assigning to different
attributes:</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.choice_ca_var.html#larch.numba.Model.choice_ca_var" title="larch.numba.Model.choice_ca_var"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.choice_ca_var</span></code></span></a>
: The choices are given by indicator values (typically but not
neccessarily dummy variables) in an <a class="reference internal" href="data-fundamentals.html#idca"><span class="std std-ref">idca</span></a> variable.</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.choice_co_code.html#larch.numba.Model.choice_co_code" title="larch.numba.Model.choice_co_code"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.choice_co_code</span></code></span></a>
: The choices are given by altid values in an <a class="reference internal" href="data-fundamentals.html#idco"><span class="std std-ref">idco</span></a> variable.
These choice codes are then converted to binary indicators
by Larch.</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.choice_co_code.html#larch.numba.Model.choice_co_code" title="larch.numba.Model.choice_co_code"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.choice_co_vars</span></code></span></a>
: The choices are given by indicator values (typically but not
neccessarily dummy variables) in multiple <a class="reference internal" href="data-fundamentals.html#idco"><span class="std std-ref">idco</span></a> variables,
one for each alternative.</p>
<p>Given the dataset (which has all these formats defined), all
the following choice definitions result in the same choice
representation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">choice_co_code</span> <span class="o">=</span> <span class="s1">&#39;ChosenCode&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">choice_co_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;ChosenCode == 1&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;ChosenCode == 2&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;ChosenCode == 3&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">choice_ca_var</span> <span class="o">=</span> <span class="s1">&#39;Chosen&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>After setting the choice definition, the loaded or computed choice array
should be available as the <code class="docutils literal notranslate"><span class="pre">'ch'</span></code> DataArray in the model’s
<a class="reference internal" href="../api/generated/larch.numba.Model.dataset.html#larch.numba.Model.dataset" title="larch.numba.Model.dataset"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">dataset</span></code></span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;ch&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;ch&#x27; (caseid: 4, altnum: 3)&gt;
array([[1, 0, 0],
       [0, 1, 0],
       [0, 0, 1],
       [0, 0, 1]])
Coordinates:
  * caseid     (caseid) int64 1 2 3 4
  * altnum     (altnum) int64 1 2 3
    alt_names  (altnum) object &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'ch'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>caseid</span>: 4</li><li><span class='xr-has-index'>altnum</span>: 3</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-c8974e72-9993-44c0-abbb-515622357637' class='xr-array-in' type='checkbox' checked><label for='section-c8974e72-9993-44c0-abbb-515622357637' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>1 0 0 0 1 0 0 0 1 0 0 1</span></div><div class='xr-array-data'><pre>array([[1, 0, 0],
       [0, 1, 0],
       [0, 0, 1],
       [0, 0, 1]])</pre></div></div></li><li class='xr-section-item'><input id='section-f2943cc2-056b-43ae-a539-cc1c47126993' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f2943cc2-056b-43ae-a539-cc1c47126993' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>caseid</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-d844c3c2-b539-497c-ae3e-02650a4be1de' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d844c3c2-b539-497c-ae3e-02650a4be1de' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9a6eccd1-3d27-4fbd-a3fe-7498749d2743' class='xr-var-data-in' type='checkbox'><label for='data-9a6eccd1-3d27-4fbd-a3fe-7498749d2743' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>altnum</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-28f75ec2-42e6-42b6-a270-4906d41a2d12' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-28f75ec2-42e6-42b6-a270-4906d41a2d12' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5ce969c8-aa14-4292-a55d-8462b8efb062' class='xr-var-data-in' type='checkbox'><label for='data-5ce969c8-aa14-4292-a55d-8462b8efb062' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>alt_names</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</div><input id='attrs-3cdf6f97-9cee-450e-8d94-d0930dc9a37d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3cdf6f97-9cee-450e-8d94-d0930dc9a37d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3d380b03-be34-48d6-8d83-6280b4651666' class='xr-var-data-in' type='checkbox'><label for='data-3d380b03-be34-48d6-8d83-6280b4651666' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7a857e8a-5b1a-448e-be3a-11bcff33af7a' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-7a857e8a-5b1a-448e-be3a-11bcff33af7a' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="availability">
<h2>Availability<a class="headerlink" href="#availability" title="Permalink to this headline">¶</a></h2>
<p>In addition to the choices, we can also define an array that describes
the availability of the various alternatives. Unlike the choices, for
the availability factors we expect that we’ll need to toggle the
availability on or off for potentially every alternative in each case,
so there’s only two ways to define availability, by assigning to
attributes:</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.availability_ca_var.html#larch.numba.Model.availability_ca_var" title="larch.numba.Model.availability_ca_var"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.availability_ca_var</span></code></span></a>
: The availability of alternatives is given by binary values
(booleans, or equivalent integers) in an <a class="reference internal" href="data-fundamentals.html#idca"><span class="std std-ref">idca</span></a> variable.</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.availability_co_vars.html#larch.numba.Model.availability_co_vars" title="larch.numba.Model.availability_co_vars"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.availability_co_vars</span></code></span></a>
: The availability of alternatives is given by binary values
(booleans, or equivalent integers) in multiple <a class="reference internal" href="data-fundamentals.html#idco"><span class="std std-ref">idco</span></a> variables,
one for each alternative.</p>
<p>Given the dataset, both of the following availability definitions
result in the same availability representation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">availability_ca_var</span> <span class="o">=</span> <span class="s2">&quot;Time &gt; 0&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">availability_co_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;BusTime &gt; 0&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;WalkTime &gt; 0&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>After setting the availability definition, the loaded or computed availability array
should be available as the <code class="docutils literal notranslate"><span class="pre">'av'</span></code> DataArray in the model’s
<a class="reference internal" href="../api/generated/larch.numba.Model.dataset.html#larch.numba.Model.dataset" title="larch.numba.Model.dataset"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">dataset</span></code></span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;av&#x27; (caseid: 4, altnum: 3)&gt;
array([[1, 1, 1],
       [1, 1, 0],
       [1, 1, 1],
       [1, 1, 1]], dtype=int8)
Coordinates:
  * caseid     (caseid) int64 1 2 3 4
  * altnum     (altnum) int64 1 2 3
    alt_names  (altnum) object &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'av'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>caseid</span>: 4</li><li><span class='xr-has-index'>altnum</span>: 3</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-9365f068-74cc-4bd6-aa67-3c682b86a9cf' class='xr-array-in' type='checkbox' checked><label for='section-9365f068-74cc-4bd6-aa67-3c682b86a9cf' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>1 1 1 1 1 0 1 1 1 1 1 1</span></div><div class='xr-array-data'><pre>array([[1, 1, 1],
       [1, 1, 0],
       [1, 1, 1],
       [1, 1, 1]], dtype=int8)</pre></div></div></li><li class='xr-section-item'><input id='section-d639c436-d64c-465e-9e5a-6db1ab504e78' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d639c436-d64c-465e-9e5a-6db1ab504e78' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>caseid</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-3976fd59-744b-4000-b7e9-595663abef3e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3976fd59-744b-4000-b7e9-595663abef3e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b8330d4a-c3ce-48ab-8364-fffa27d91211' class='xr-var-data-in' type='checkbox'><label for='data-b8330d4a-c3ce-48ab-8364-fffa27d91211' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>altnum</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-bbd4d072-80e2-44ac-b793-4e1e9434b3ab' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bbd4d072-80e2-44ac-b793-4e1e9434b3ab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9dc78131-77c9-4ebd-bd50-a1bc9a16ae70' class='xr-var-data-in' type='checkbox'><label for='data-9dc78131-77c9-4ebd-bd50-a1bc9a16ae70' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>alt_names</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</div><input id='attrs-33271ffe-1b82-43b8-a675-6ac73ae0a840' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-33271ffe-1b82-43b8-a675-6ac73ae0a840' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6f4a318a-828e-4a8c-8a5d-166e0312fd37' class='xr-var-data-in' type='checkbox'><label for='data-6f4a318a-828e-4a8c-8a5d-166e0312fd37' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;], dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-747b159d-9efa-4bea-8bec-312bbdad2620' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-747b159d-9efa-4bea-8bec-312bbdad2620' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="utility-functions">
<h2>Utility Functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h2>
<p>Choice models in Larch rely on utility expressions that are
<a class="reference internal" href="linear-funcs.html#linear-funcs"><span class="std std-ref">linear-in-parameters functions</span></a>, which combine
parameters <a class="reference internal" href="../api/linear.html#larch.model.linear.ParameterRef_C" title="larch.model.linear.ParameterRef_C"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">P</span></code></span></a> and data
<a class="reference internal" href="../api/linear.html#larch.model.linear.DataRef_C" title="larch.model.linear.DataRef_C"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">X</span></code></span></a>. You can attach these function
expressions to the model in two ways:</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.utility_ca.html#larch.numba.Model.utility_ca" title="larch.numba.Model.utility_ca"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.utility_ca</span></code></span></a>
: A linear function containing generic expressions
that are evaluated against the <a class="reference internal" href="data-fundamentals.html#idca"><span class="std std-ref">idca</span></a> portion of the dataset.
These expression can technically also reference <a class="reference internal" href="data-fundamentals.html#idco"><span class="std std-ref">idco</span></a> variables,
but to define a well-specified choice model with identifiable
parameters, each data term will need at least one <a class="reference internal" href="data-fundamentals.html#idca"><span class="std std-ref">idca</span></a>
component.</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.utility_co.html#larch.numba.Model.utility_co" title="larch.numba.Model.utility_co"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.utility_co</span></code></span></a>
: A mapping of alternative-specific expressions that are evaluated
against only the <a class="reference internal" href="data-fundamentals.html#idco"><span class="std std-ref">idco</span></a> portion of the dataset. Each key gives
an alternative id, and the values are linear functions.</p>
<p>These two utility function definitions are not mutually
exclusive, and you can mix both types of functions in the same
model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">larch</span> <span class="kn">import</span> <span class="n">P</span><span class="p">,</span> <span class="n">X</span>

<span class="n">m</span><span class="o">.</span><span class="n">utility_ca</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Time</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">Time</span> <span class="o">+</span> <span class="n">P</span><span class="o">.</span><span class="n">Cost</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">Cost</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">utility_co</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">Income_Car</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">Income</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">Income_Bus</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">Income</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The computed values for the utility function can be accessed using
the <a class="reference internal" href="../api/generated/larch.numba.Model.utility.html#larch.numba.Model.utility" title="larch.numba.Model.utility"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">utility</span></code></span></a> method, which also permits
the user to set new values for various model parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">utility</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;Income_Car&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
    <span class="n">return_format</span><span class="o">=</span><span class="s1">&#39;dataarray&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (caseid: 4, nodeid: 4)&gt;
array([[-0.3       , -2.4       , -0.2       ,  0.50093705],
       [ 0.25      , -2.35      ,        -inf,  0.32164469],
       [ 1.1       , -2.        , -0.3       ,  1.3559175 ],
       [ 0.35      , -3.2       , -0.1       ,  0.86063728]])
Coordinates:
  * caseid     (caseid) int64 1 2 3 4
  * nodeid     (nodeid) int64 1 2 3 0
    node_name  (nodeid) &lt;U6 &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27; &#x27;_root_&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>caseid</span>: 4</li><li><span class='xr-has-index'>nodeid</span>: 4</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-827c6baf-42c8-4c4b-b80a-20ebc60d2a27' class='xr-array-in' type='checkbox' checked><label for='section-827c6baf-42c8-4c4b-b80a-20ebc60d2a27' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>-0.3 -2.4 -0.2 0.5009 0.25 -2.35 ... -0.3 1.356 0.35 -3.2 -0.1 0.8606</span></div><div class='xr-array-data'><pre>array([[-0.3       , -2.4       , -0.2       ,  0.50093705],
       [ 0.25      , -2.35      ,        -inf,  0.32164469],
       [ 1.1       , -2.        , -0.3       ,  1.3559175 ],
       [ 0.35      , -3.2       , -0.1       ,  0.86063728]])</pre></div></div></li><li class='xr-section-item'><input id='section-7b2ae680-b3fe-4ab2-b974-dbe7e1109593' class='xr-section-summary-in' type='checkbox'  checked><label for='section-7b2ae680-b3fe-4ab2-b974-dbe7e1109593' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>caseid</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-d49022d9-6ecd-4cf1-a5a2-a67eec3f0188' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d49022d9-6ecd-4cf1-a5a2-a67eec3f0188' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e3a619a9-97dd-4b06-bd64-4554818a4ea9' class='xr-var-data-in' type='checkbox'><label for='data-e3a619a9-97dd-4b06-bd64-4554818a4ea9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>nodeid</span></div><div class='xr-var-dims'>(nodeid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 0</div><input id='attrs-4c7a67f9-8e3e-4564-9413-2348b39f382c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4c7a67f9-8e3e-4564-9413-2348b39f382c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c0f2b017-183d-42da-a55b-dd956fe9cffc' class='xr-var-data-in' type='checkbox'><label for='data-c0f2b017-183d-42da-a55b-dd956fe9cffc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 0])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>node_name</span></div><div class='xr-var-dims'>(nodeid)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27; &#x27;_root_&#x27;</div><input id='attrs-e36f8341-9e8d-4436-a669-59cc5d365538' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e36f8341-9e8d-4436-a669-59cc5d365538' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b1db63a1-2a0a-4789-b066-0bad3557e221' class='xr-var-data-in' type='checkbox'><label for='data-b1db63a1-2a0a-4789-b066-0bad3557e221' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;, &#x27;_root_&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-745efc8c-3960-4f4c-ac2c-9804cd24e00e' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-745efc8c-3960-4f4c-ac2c-9804cd24e00e' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="data-preparation">
<h2>Data Preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<p>Larch works with two “tiers” of data:</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.datatree.html#larch.numba.Model.datatree" title="larch.numba.Model.datatree"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.datatree</span></code></span></a>
: A <code class="docutils literal notranslate"><span class="pre">DataTree</span></code> that holds the raw data used for the model. This can
consist of just a single <code class="docutils literal notranslate"><span class="pre">Dataset</span></code>, (which is automatically converted
into a one-node tree when you assign it to this attribute) or multiple<br />
related datasets linked together using the <code class="docutils literal notranslate"><span class="pre">sharrow</span></code> library.</p>
<p><a class="reference internal" href="../api/generated/larch.numba.Model.dataset.html#larch.numba.Model.dataset" title="larch.numba.Model.dataset"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">m.dataset</span></code></span></a>
: The assembled arrays actually used in calculation, stored
as a <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> that has variables for various required data elements
and dimensions structured to support the model design.
The dataset is wiped out when any aspect of the model structure is
changed, and rebuilt as needed for computation. For
particular applications that require specialized
optimization, the dataset can be provided exogenously after the
model stucture is finalized, but generally
it will be convenient for users to let Larch build the dataset
automatically from a <a class="reference internal" href="../api/generated/larch.numba.Model.datatree.html#larch.numba.Model.datatree" title="larch.numba.Model.datatree"><span class="xref myst py py-attr">datatree</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">datatree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;larch.dataset.DataTree&gt;
 datasets:
 - main
 relationships: none
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (caseid: 4, altnum: 3, var_co: 1, var_ca: 2)
Coordinates:
  * caseid     (caseid) int64 1 2 3 4
  * altnum     (altnum) int64 1 2 3
    alt_names  (altnum) object &#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;
  * var_co     (var_co) &lt;U6 &#x27;Income&#x27;
  * var_ca     (var_ca) &lt;U4 &#x27;Cost&#x27; &#x27;Time&#x27;
Data variables:
    co         (caseid, var_co) float64 3e+04 3e+04 4e+04 5e+04
    ca         (caseid, altnum, var_ca) float64 150.0 30.0 100.0 ... 0.0 10.0
    ch         (caseid, altnum) int64 1 0 0 0 1 0 0 0 1 0 0 1
    av         (caseid, altnum) int8 1 1 1 1 1 0 1 1 1 1 1 1
Attributes:
    _caseid_:  caseid
    _altid_:   altnum</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-22f1acfa-16a4-4ed4-bf80-2766914a4e12' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-22f1acfa-16a4-4ed4-bf80-2766914a4e12' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>caseid</span>: 4</li><li><span class='xr-has-index'>altnum</span>: 3</li><li><span class='xr-has-index'>var_co</span>: 1</li><li><span class='xr-has-index'>var_ca</span>: 2</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-d4aa78ee-bc7c-41ca-ad70-832a7cd816e0' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d4aa78ee-bc7c-41ca-ad70-832a7cd816e0' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>caseid</span></div><div class='xr-var-dims'>(caseid)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-3df2a863-02d5-4fc1-a387-05235f77adf4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3df2a863-02d5-4fc1-a387-05235f77adf4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-23dafac7-bcb9-48cf-a2e1-5cf9763902f2' class='xr-var-data-in' type='checkbox'><label for='data-23dafac7-bcb9-48cf-a2e1-5cf9763902f2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>altnum</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-16d10ad7-96db-4714-b487-5bf884027115' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-16d10ad7-96db-4714-b487-5bf884027115' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-02ea61fb-f486-4cfe-9fab-d5c4787dcf07' class='xr-var-data-in' type='checkbox'><label for='data-02ea61fb-f486-4cfe-9fab-d5c4787dcf07' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>alt_names</span></div><div class='xr-var-dims'>(altnum)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>&#x27;Car&#x27; &#x27;Bus&#x27; &#x27;Walk&#x27;</div><input id='attrs-584ad335-855b-42f9-ba00-82a362d35142' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-584ad335-855b-42f9-ba00-82a362d35142' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5cf99d7b-9a8a-468b-a10b-52fd39029506' class='xr-var-data-in' type='checkbox'><label for='data-5cf99d7b-9a8a-468b-a10b-52fd39029506' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Car&#x27;, &#x27;Bus&#x27;, &#x27;Walk&#x27;], dtype=object)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>var_co</span></div><div class='xr-var-dims'>(var_co)</div><div class='xr-var-dtype'>&lt;U6</div><div class='xr-var-preview xr-preview'>&#x27;Income&#x27;</div><input id='attrs-df7e67d4-90e1-45b9-9a9e-97206fca6cb0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-df7e67d4-90e1-45b9-9a9e-97206fca6cb0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4fbd2d19-3997-46c5-a3c8-51b679c8ca79' class='xr-var-data-in' type='checkbox'><label for='data-4fbd2d19-3997-46c5-a3c8-51b679c8ca79' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Income&#x27;], dtype=&#x27;&lt;U6&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>var_ca</span></div><div class='xr-var-dims'>(var_ca)</div><div class='xr-var-dtype'>&lt;U4</div><div class='xr-var-preview xr-preview'>&#x27;Cost&#x27; &#x27;Time&#x27;</div><input id='attrs-98fb77fe-8eb1-4675-88ae-6856b2f0123a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-98fb77fe-8eb1-4675-88ae-6856b2f0123a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9956b201-e40e-4562-976f-7ff2d7b3a7c9' class='xr-var-data-in' type='checkbox'><label for='data-9956b201-e40e-4562-976f-7ff2d7b3a7c9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Cost&#x27;, &#x27;Time&#x27;], dtype=&#x27;&lt;U4&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-97c7a0f7-f28c-4649-b13c-7c8e94203736' class='xr-section-summary-in' type='checkbox'  checked><label for='section-97c7a0f7-f28c-4649-b13c-7c8e94203736' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>co</span></div><div class='xr-var-dims'>(caseid, var_co)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3e+04 3e+04 4e+04 5e+04</div><input id='attrs-49c86fc6-859b-4fe6-8efa-660646010141' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-49c86fc6-859b-4fe6-8efa-660646010141' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-40710ed5-cd66-4925-8b4d-f1e96a9112c3' class='xr-var-data-in' type='checkbox'><label for='data-40710ed5-cd66-4925-8b4d-f1e96a9112c3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[30000.],
       [30000.],
       [40000.],
       [50000.]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ca</span></div><div class='xr-var-dims'>(caseid, altnum, var_ca)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>150.0 30.0 100.0 ... 20.0 0.0 10.0</div><input id='attrs-1b854e28-51fd-473d-b8de-ae10e3b7c909' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1b854e28-51fd-473d-b8de-ae10e3b7c909' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-508ae8b7-8371-4b61-b2bb-bbe3aa8d7514' class='xr-var-data-in' type='checkbox'><label for='data-508ae8b7-8371-4b61-b2bb-bbe3aa8d7514' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[150.,  30.],
        [100.,  40.],
        [  0.,  20.]],

       [[125.,  25.],
        [100.,  35.],
        [  0.,   0.]],

       [[125.,  40.],
        [ 75.,  50.],
        [  0.,  30.]],

       [[225.,  15.],
        [150.,  20.],
        [  0.,  10.]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>ch</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 0 0 0 1 0 0 0 1 0 0 1</div><input id='attrs-93481858-5ccb-422f-907a-5c0263b82029' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-93481858-5ccb-422f-907a-5c0263b82029' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ec8b9d07-5f88-4fdc-962c-9f4a8cf160ec' class='xr-var-data-in' type='checkbox'><label for='data-ec8b9d07-5f88-4fdc-962c-9f4a8cf160ec' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1, 0, 0],
       [0, 1, 0],
       [0, 0, 1],
       [0, 0, 1]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>av</span></div><div class='xr-var-dims'>(caseid, altnum)</div><div class='xr-var-dtype'>int8</div><div class='xr-var-preview xr-preview'>1 1 1 1 1 0 1 1 1 1 1 1</div><input id='attrs-3d8d33de-efa7-4e13-9bc9-cbc18ee39b5c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3d8d33de-efa7-4e13-9bc9-cbc18ee39b5c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-32b644f1-8cdb-4859-ba65-3dc704ffcf0e' class='xr-var-data-in' type='checkbox'><label for='data-32b644f1-8cdb-4859-ba65-3dc704ffcf0e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1, 1, 1],
       [1, 1, 0],
       [1, 1, 1],
       [1, 1, 1]], dtype=int8)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-6f377b85-c6ee-42d2-babd-d490cea66c2e' class='xr-section-summary-in' type='checkbox'  checked><label for='section-6f377b85-c6ee-42d2-babd-d490cea66c2e' class='xr-section-summary' >Attributes: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>_caseid_ :</span></dt><dd>caseid</dd><dt><span>_altid_ :</span></dt><dd>altnum</dd></dl></div></li></ul></div></div></div></div>
</div>
</div>
<div class="section" id="nesting-structures">
<h2>Nesting Structures<a class="headerlink" href="#nesting-structures" title="Permalink to this headline">¶</a></h2>
<p>By default, a model in Larch is assumed to be a simple multinomial
logit model, unless a nesting structure is defined. That structure
is defined in a model’s <span class="xref myst"><code class="docutils literal notranslate"><span class="pre">graph</span></code></span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div xmlns="http://www.w3.org/2000/svg"><svg width="320pt" height="132pt" viewBox="0.00 0.00 320.00 132.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 128)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-128 316,-128 316,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_elemental</title>
<path fill="lightgrey" stroke="white" d="M20,-8C20,-8 292,-8 292,-8 298,-8 304,-14 304,-20 304,-20 304,-48 304,-48 304,-54 298,-60 292,-60 292,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8"></path>
</g>

<g id="node1" class="node">
<title>0</title>
<polygon fill="none" stroke="black" points="135,-100.44 162,-88 189,-100.44 188.97,-120.56 135.03,-120.56 135,-100.44"></polygon>
<text text-anchor="middle" x="162" y="-102.3" font-family="Times,serif" font-size="14.00">0</text>
</g>

<g id="node2" class="node">
<title>1</title>
<ellipse fill="white" stroke="black" cx="258" cy="-34" rx="38.19" ry="18"></ellipse>
<text text-anchor="start" x="236.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(1) </text>
<text text-anchor="start" x="253.5" y="-31.3" font-family="Times,serif" font-size="14.00">Car</text>
</g>

<g id="edge1" class="edge">
<title>0-&gt;1</title>
<path fill="none" stroke="black" d="M176.58,-94.37C190.64,-84.11 212.31,-68.32 229.75,-55.6"></path>
<polygon fill="black" stroke="black" points="231.91,-58.36 237.93,-49.64 227.78,-52.7 231.91,-58.36"></polygon>
</g>

<g id="node3" class="node">
<title>2</title>
<ellipse fill="white" stroke="black" cx="162" cy="-34" rx="39.79" ry="18"></ellipse>
<text text-anchor="start" x="139.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(2) </text>
<text text-anchor="start" x="156.5" y="-31.3" font-family="Times,serif" font-size="14.00">Bus</text>
</g>

<g id="edge2" class="edge">
<title>0-&gt;2</title>
<path fill="none" stroke="black" d="M162,-87.7C162,-79.98 162,-70.71 162,-62.11"></path>
<polygon fill="black" stroke="black" points="165.5,-62.1 162,-52.1 158.5,-62.1 165.5,-62.1"></polygon>
</g>

<g id="node4" class="node">
<title>3</title>
<ellipse fill="white" stroke="black" cx="60" cy="-34" rx="44.39" ry="18"></ellipse>
<text text-anchor="start" x="34" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(3) </text>
<text text-anchor="start" x="51" y="-31.3" font-family="Times,serif" font-size="14.00">Walk</text>
</g>

<g id="edge3" class="edge">
<title>0-&gt;3</title>
<path fill="none" stroke="black" d="M146.95,-94.67C132.02,-84.43 108.74,-68.45 90.02,-55.6"></path>
<polygon fill="black" stroke="black" points="91.75,-52.54 81.52,-49.77 87.79,-58.31 91.75,-52.54"></polygon>
</g>
</g>
</svg></div></div></div>
</div>
<p>Adding a nest can be accomplished the the <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.new_node.html#larch.model.tree.NestingTree.new_node" title="larch.model.tree.NestingTree.new_node"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">new_node</span></code></span></a> method,
which allows you to give a nesting node’s child codes, a name, and attach a logsum parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">new_node</span><span class="p">(</span><span class="n">parameter</span><span class="o">=</span><span class="s1">&#39;Mu_Motorized&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Motorized&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div xmlns="http://www.w3.org/2000/svg"><svg width="320pt" height="204pt" viewBox="0.00 0.00 320.00 204.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 200)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-200 316,-200 316,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_elemental</title>
<path fill="lightgrey" stroke="white" d="M20,-8C20,-8 292,-8 292,-8 298,-8 304,-14 304,-20 304,-20 304,-48 304,-48 304,-54 298,-60 292,-60 292,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8"></path>
</g>

<g id="node1" class="node">
<title>0</title>
<polygon fill="none" stroke="black" points="84,-172.44 111,-160 138,-172.44 137.97,-192.56 84.03,-192.56 84,-172.44"></polygon>
<text text-anchor="middle" x="111" y="-174.3" font-family="Times,serif" font-size="14.00">0</text>
</g>

<g id="node4" class="node">
<title>3</title>
<ellipse fill="white" stroke="black" cx="60" cy="-34" rx="44.39" ry="18"></ellipse>
<text text-anchor="start" x="34" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(3) </text>
<text text-anchor="start" x="51" y="-31.3" font-family="Times,serif" font-size="14.00">Walk</text>
</g>

<g id="edge1" class="edge">
<title>0-&gt;3</title>
<path fill="none" stroke="black" d="M105.73,-162.34C97.22,-138.63 80.31,-91.54 69.6,-61.74"></path>
<polygon fill="black" stroke="black" points="72.78,-60.22 66.1,-51.99 66.19,-62.58 72.78,-60.22"></polygon>
</g>

<g id="node5" class="node">
<title>4</title>
<path fill="none" stroke="black" d="M203,-124C203,-124 121,-124 121,-124 115,-124 109,-118 109,-112 109,-112 109,-100 109,-100 109,-94 115,-88 121,-88 121,-88 203,-88 203,-88 209,-88 215,-94 215,-100 215,-100 215,-112 215,-112 215,-118 209,-124 203,-124"></path>
<text text-anchor="start" x="117" y="-107.3" font-family="Times,serif" font-size="9.00" fill="#999999">(4) </text>
<text text-anchor="start" x="134" y="-107.3" font-family="Times,serif" font-size="14.00">Motorized</text>
<text text-anchor="start" x="128.5" y="-97.3" font-family="Times,serif" font-style="italic" font-size="9.00" fill="#999999">Mu_Motorized</text>
</g>

<g id="edge2" class="edge">
<title>0-&gt;4</title>
<path fill="none" stroke="black" d="M120.35,-164.16C126.8,-155.32 135.58,-143.26 143.42,-132.51"></path>
<polygon fill="black" stroke="black" points="146.38,-134.39 149.44,-124.24 140.72,-130.26 146.38,-134.39"></polygon>
</g>

<g id="node2" class="node">
<title>1</title>
<ellipse fill="white" stroke="black" cx="258" cy="-34" rx="38.19" ry="18"></ellipse>
<text text-anchor="start" x="236.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(1) </text>
<text text-anchor="start" x="253.5" y="-31.3" font-family="Times,serif" font-size="14.00">Car</text>
</g>

<g id="node3" class="node">
<title>2</title>
<ellipse fill="white" stroke="black" cx="162" cy="-34" rx="39.79" ry="18"></ellipse>
<text text-anchor="start" x="139.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(2) </text>
<text text-anchor="start" x="156.5" y="-31.3" font-family="Times,serif" font-size="14.00">Bus</text>
</g>

<g id="edge3" class="edge">
<title>4-&gt;1</title>
<path fill="none" stroke="black" d="M185.73,-87.7C199.06,-77.97 215.79,-65.78 229.79,-55.57"></path>
<polygon fill="black" stroke="black" points="232.09,-58.23 238.1,-49.51 227.96,-52.57 232.09,-58.23"></polygon>
</g>

<g id="edge4" class="edge">
<title>4-&gt;2</title>
<path fill="none" stroke="black" d="M162,-87.7C162,-79.98 162,-70.71 162,-62.11"></path>
<polygon fill="black" stroke="black" points="165.5,-62.1 162,-52.1 158.5,-62.1 165.5,-62.1"></polygon>
</g>
</g>
</svg></div></div></div>
</div>
<p>The return value of <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.new_node.html#larch.model.tree.NestingTree.new_node" title="larch.model.tree.NestingTree.new_node"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">new_node</span></code></span></a>
is the code number of the new nest. This is assigned automatically so
as to not overlap with any other alternatives or nests.  We can use this
to develop multi-level nesting structures, by putting that new code
number as the child for yet another new nest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">new_node</span><span class="p">(</span><span class="n">parameter</span><span class="o">=</span><span class="s1">&#39;Mu_Omni&#39;</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Omni&#39;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div xmlns="http://www.w3.org/2000/svg"><svg width="320pt" height="276pt" viewBox="0.00 0.00 320.00 276.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 272)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-272 316,-272 316,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_elemental</title>
<path fill="lightgrey" stroke="white" d="M20,-8C20,-8 292,-8 292,-8 298,-8 304,-14 304,-20 304,-20 304,-48 304,-48 304,-54 298,-60 292,-60 292,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8"></path>
</g>

<g id="node1" class="node">
<title>0</title>
<polygon fill="none" stroke="black" points="84,-244.44 111,-232 138,-244.44 137.97,-264.56 84.03,-264.56 84,-244.44"></polygon>
<text text-anchor="middle" x="111" y="-246.3" font-family="Times,serif" font-size="14.00">0</text>
</g>

<g id="node6" class="node">
<title>5</title>
<path fill="none" stroke="black" d="M135,-196C135,-196 87,-196 87,-196 81,-196 75,-190 75,-184 75,-184 75,-172 75,-172 75,-166 81,-160 87,-160 87,-160 135,-160 135,-160 141,-160 147,-166 147,-172 147,-172 147,-184 147,-184 147,-190 141,-196 135,-196"></path>
<text text-anchor="start" x="83" y="-179.3" font-family="Times,serif" font-size="9.00" fill="#999999">(5) </text>
<text text-anchor="start" x="100" y="-179.3" font-family="Times,serif" font-size="14.00">Omni</text>
<text text-anchor="start" x="88.5" y="-169.3" font-family="Times,serif" font-style="italic" font-size="9.00" fill="#999999">Mu_Omni</text>
</g>

<g id="edge1" class="edge">
<title>0-&gt;5</title>
<path fill="none" stroke="black" d="M111,-231.7C111,-223.98 111,-214.71 111,-206.11"></path>
<polygon fill="black" stroke="black" points="114.5,-206.1 111,-196.1 107.5,-206.1 114.5,-206.1"></polygon>
</g>

<g id="node2" class="node">
<title>1</title>
<ellipse fill="white" stroke="black" cx="258" cy="-34" rx="38.19" ry="18"></ellipse>
<text text-anchor="start" x="236.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(1) </text>
<text text-anchor="start" x="253.5" y="-31.3" font-family="Times,serif" font-size="14.00">Car</text>
</g>

<g id="node3" class="node">
<title>2</title>
<ellipse fill="white" stroke="black" cx="162" cy="-34" rx="39.79" ry="18"></ellipse>
<text text-anchor="start" x="139.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(2) </text>
<text text-anchor="start" x="156.5" y="-31.3" font-family="Times,serif" font-size="14.00">Bus</text>
</g>

<g id="node4" class="node">
<title>3</title>
<ellipse fill="white" stroke="black" cx="60" cy="-34" rx="44.39" ry="18"></ellipse>
<text text-anchor="start" x="34" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(3) </text>
<text text-anchor="start" x="51" y="-31.3" font-family="Times,serif" font-size="14.00">Walk</text>
</g>

<g id="node5" class="node">
<title>4</title>
<path fill="none" stroke="black" d="M203,-124C203,-124 121,-124 121,-124 115,-124 109,-118 109,-112 109,-112 109,-100 109,-100 109,-94 115,-88 121,-88 121,-88 203,-88 203,-88 209,-88 215,-94 215,-100 215,-100 215,-112 215,-112 215,-118 209,-124 203,-124"></path>
<text text-anchor="start" x="117" y="-107.3" font-family="Times,serif" font-size="9.00" fill="#999999">(4) </text>
<text text-anchor="start" x="134" y="-107.3" font-family="Times,serif" font-size="14.00">Motorized</text>
<text text-anchor="start" x="128.5" y="-97.3" font-family="Times,serif" font-style="italic" font-size="9.00" fill="#999999">Mu_Motorized</text>
</g>

<g id="edge2" class="edge">
<title>4-&gt;1</title>
<path fill="none" stroke="black" d="M185.73,-87.7C199.06,-77.97 215.79,-65.78 229.79,-55.57"></path>
<polygon fill="black" stroke="black" points="232.09,-58.23 238.1,-49.51 227.96,-52.57 232.09,-58.23"></polygon>
</g>

<g id="edge3" class="edge">
<title>4-&gt;2</title>
<path fill="none" stroke="black" d="M162,-87.7C162,-79.98 162,-70.71 162,-62.11"></path>
<polygon fill="black" stroke="black" points="165.5,-62.1 162,-52.1 158.5,-62.1 165.5,-62.1"></polygon>
</g>

<g id="edge5" class="edge">
<title>5-&gt;3</title>
<path fill="none" stroke="black" d="M104.85,-159.87C96.08,-135.46 79.91,-90.43 69.57,-61.64"></path>
<polygon fill="black" stroke="black" points="72.85,-60.42 66.17,-52.19 66.26,-62.78 72.85,-60.42"></polygon>
</g>

<g id="edge4" class="edge">
<title>5-&gt;4</title>
<path fill="none" stroke="black" d="M123.61,-159.7C129.6,-151.47 136.88,-141.48 143.48,-132.42"></path>
<polygon fill="black" stroke="black" points="146.48,-134.25 149.54,-124.1 140.82,-130.13 146.48,-134.25"></polygon>
</g>
</g>
</svg></div></div></div>
</div>
<p>Nothing in Larch prevents you from overloading the nesting structure with
degenerate nests, as shown above.  You may have difficult with estimating
parameters if you are not careful with such complex structures.  If you
need to <a class="reference internal" href="../api/generated/larch.model.tree.NestingTree.remove_node.html#larch.model.tree.NestingTree.remove_node" title="larch.model.tree.NestingTree.remove_node"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">remove_node</span></code></span></a>, you
can do so by giving its code–but you’ll likely find you’ll be much better off
just fixing your code and starting over, as node removal can have some odd
side effects for complex structures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div xmlns="http://www.w3.org/2000/svg"><svg width="320pt" height="204pt" viewBox="0.00 0.00 320.00 204.00">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 200)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-200 316,-200 316,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_elemental</title>
<path fill="lightgrey" stroke="white" d="M20,-8C20,-8 292,-8 292,-8 298,-8 304,-14 304,-20 304,-20 304,-48 304,-48 304,-54 298,-60 292,-60 292,-60 20,-60 20,-60 14,-60 8,-54 8,-48 8,-48 8,-20 8,-20 8,-14 14,-8 20,-8"></path>
</g>

<g id="node1" class="node">
<title>0</title>
<polygon fill="none" stroke="black" points="84,-172.44 111,-160 138,-172.44 137.97,-192.56 84.03,-192.56 84,-172.44"></polygon>
<text text-anchor="middle" x="111" y="-174.3" font-family="Times,serif" font-size="14.00">0</text>
</g>

<g id="node4" class="node">
<title>3</title>
<ellipse fill="white" stroke="black" cx="60" cy="-34" rx="44.39" ry="18"></ellipse>
<text text-anchor="start" x="34" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(3) </text>
<text text-anchor="start" x="51" y="-31.3" font-family="Times,serif" font-size="14.00">Walk</text>
</g>

<g id="edge2" class="edge">
<title>0-&gt;3</title>
<path fill="none" stroke="black" d="M105.73,-162.34C97.22,-138.63 80.31,-91.54 69.6,-61.74"></path>
<polygon fill="black" stroke="black" points="72.78,-60.22 66.1,-51.99 66.19,-62.58 72.78,-60.22"></polygon>
</g>

<g id="node5" class="node">
<title>4</title>
<path fill="none" stroke="black" d="M203,-124C203,-124 121,-124 121,-124 115,-124 109,-118 109,-112 109,-112 109,-100 109,-100 109,-94 115,-88 121,-88 121,-88 203,-88 203,-88 209,-88 215,-94 215,-100 215,-100 215,-112 215,-112 215,-118 209,-124 203,-124"></path>
<text text-anchor="start" x="117" y="-107.3" font-family="Times,serif" font-size="9.00" fill="#999999">(4) </text>
<text text-anchor="start" x="134" y="-107.3" font-family="Times,serif" font-size="14.00">Motorized</text>
<text text-anchor="start" x="128.5" y="-97.3" font-family="Times,serif" font-style="italic" font-size="9.00" fill="#999999">Mu_Motorized</text>
</g>

<g id="edge1" class="edge">
<title>0-&gt;4</title>
<path fill="none" stroke="black" d="M120.35,-164.16C126.8,-155.32 135.58,-143.26 143.42,-132.51"></path>
<polygon fill="black" stroke="black" points="146.38,-134.39 149.44,-124.24 140.72,-130.26 146.38,-134.39"></polygon>
</g>

<g id="node2" class="node">
<title>1</title>
<ellipse fill="white" stroke="black" cx="258" cy="-34" rx="38.19" ry="18"></ellipse>
<text text-anchor="start" x="236.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(1) </text>
<text text-anchor="start" x="253.5" y="-31.3" font-family="Times,serif" font-size="14.00">Car</text>
</g>

<g id="node3" class="node">
<title>2</title>
<ellipse fill="white" stroke="black" cx="162" cy="-34" rx="39.79" ry="18"></ellipse>
<text text-anchor="start" x="139.5" y="-31.3" font-family="Times,serif" font-size="9.00" fill="#999999">(2) </text>
<text text-anchor="start" x="156.5" y="-31.3" font-family="Times,serif" font-size="14.00">Bus</text>
</g>

<g id="edge3" class="edge">
<title>4-&gt;1</title>
<path fill="none" stroke="black" d="M185.73,-87.7C199.06,-77.97 215.79,-65.78 229.79,-55.57"></path>
<polygon fill="black" stroke="black" points="232.09,-58.23 238.1,-49.51 227.96,-52.57 232.09,-58.23"></polygon>
</g>

<g id="edge4" class="edge">
<title>4-&gt;2</title>
<path fill="none" stroke="black" d="M162,-87.7C162,-79.98 162,-70.71 162,-62.11"></path>
<polygon fill="black" stroke="black" points="165.5,-62.1 162,-52.1 158.5,-62.1 165.5,-62.1"></polygon>
</g>
</g>
</svg></div></div></div>
</div>
</div>
<div class="section" id="parameter-estimation">
<h2>Parameter Estimation<a class="headerlink" href="#parameter-estimation" title="Permalink to this headline">¶</a></h2>
<p>Larch can automatically find all the model parameters contained in the model
specification, so we don’t need to address them separately unless we want
to modify any defaults.</p>
<p>We can review the parameters Larch has found, as well as the current values
set for them, in the parameter frame, or <a class="reference internal" href="../api/generated/larch.numba.Model.pf.html#larch.numba.Model.pf" title="larch.numba.Model.pf"><span class="xref myst py py-attr"><code class="docutils literal notranslate"><span class="pre">pf</span></code></span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">pf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>initvalue</th>
      <th>nullvalue</th>
      <th>minimum</th>
      <th>maximum</th>
      <th>holdfast</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.02</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.10</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.00</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.001</td>
      <td>1.0</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we want to set certain parameters to be constrained to be certain values,
that can be accomplished with the <a class="reference internal" href="../api/generated/larch.numba.Model.lock_value.html#larch.numba.Model.lock_value" title="larch.numba.Model.lock_value"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">lock_value</span></code></span></a> method.
Because our sample data has so few observations, it won’t be possible to estimate
values for all four parameters, so we can assert values for two of them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">lock_value</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">lock_value</span><span class="p">(</span><span class="s1">&#39;Cost&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">pf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>initvalue</th>
      <th>nullvalue</th>
      <th>minimum</th>
      <th>maximum</th>
      <th>holdfast</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.020</td>
      <td>-0.02</td>
      <td>1</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.10</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-inf</td>
      <td>inf</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.001</td>
      <td>1.00</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.010</td>
      <td>-0.01</td>
      <td>1</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The default infinite bounds on the remaining parameters can be problematic
for some optimization algorithms, so it’s usually good practice to set large
but finite limits for those values.  The <a class="reference internal" href="../api/generated/larch.numba.Model.set_cap.html#larch.numba.Model.set_cap" title="larch.numba.Model.set_cap"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">set_cap</span></code></span></a> method
can do just that, setting a minimum and maximum value for all the parameters
that otherwise have bounds outside the cap.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">set_cap</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">pf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>initvalue</th>
      <th>nullvalue</th>
      <th>minimum</th>
      <th>maximum</th>
      <th>holdfast</th>
      <th>note</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.020</td>
      <td>-0.02</td>
      <td>1</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.10</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.00</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.001</td>
      <td>1.00</td>
      <td>0</td>
      <td></td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.010</td>
      <td>-0.01</td>
      <td>1</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To actually develop maximum likelihood estimates for the remaining
unconstrained parameters, use the
<a class="reference internal" href="../api/generated/larch.numba.Model.maximize_loglike.html#larch.numba.Model.maximize_loglike" title="larch.numba.Model.maximize_loglike"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">maximize_loglike</span></code></span></a> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">maximize_loglike</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><h3>Iteration 006 [Optimization terminated successfully] </h3></div><div class="output text_html"><p>Best LL = -3.7482392442904424</p></div><div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>initvalue</th>
      <th>nullvalue</th>
      <th>minimum</th>
      <th>maximum</th>
      <th>holdfast</th>
      <th>note</th>
      <th>best</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.020000</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.020</td>
      <td>-0.02</td>
      <td>1</td>
      <td></td>
      <td>-0.020000</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.015746</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
      <td>0.015746</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.036117</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
      <td>0.036117</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.000000</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.001</td>
      <td>1.00</td>
      <td>0</td>
      <td></td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.010000</td>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.010</td>
      <td>-0.01</td>
      <td>1</td>
      <td></td>
      <td>-0.010000</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output text_html"><div><table style="margin-top:1px;"><tr><th>key</th><th style="text-align:left;">value</th></tr><tr><td>x</td><td style="text-align:left;"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.020000</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.015746</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.036117</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.010000</td>
    </tr>
  </tbody>
</table></td></tr><tr><td>loglike</td><td style="text-align:left;">-3.7482392442904424</td></tr><tr><td>d_loglike</td><td style="text-align:left;"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>-0.018819</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.012997</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>0.433917</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table></td></tr><tr><td>nit</td><td style="text-align:left;">6</td></tr><tr><td>nfev</td><td style="text-align:left;">15</td></tr><tr><td>njev</td><td style="text-align:left;">6</td></tr><tr><td>status</td><td style="text-align:left;">0</td></tr><tr><td>message</td><td style="text-align:left;">'Optimization terminated successfully'</td></tr><tr><td>success</td><td style="text-align:left;">True</td></tr><tr><td>elapsed_time</td><td style="text-align:left;">0:00:00.024836</td></tr><tr><td>method</td><td style="text-align:left;">'slsqp'</td></tr><tr><td>n_cases</td><td style="text-align:left;">4</td></tr><tr><td>iteration_number</td><td style="text-align:left;">6</td></tr><tr><td>logloss</td><td style="text-align:left;">0.9370598110726106</td></tr></table></div></div></div>
</div>
<p>In a Jupyter notebook, this method displays a live-updating view of the
progress of the optmization algorithm, so that the analyst can interrupt
if something looks wrong.</p>
<p>The <a class="reference internal" href="../api/generated/larch.numba.Model.maximize_loglike.html#larch.numba.Model.maximize_loglike" title="larch.numba.Model.maximize_loglike"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">maximize_loglike</span></code></span></a> method does
not include the calculation of parameter covariance matrixes, standard
errors, or t-statistics.  For large models, this can be a computationally
expensive process, and it is often but not <em>always</em> necessary. Those
computatations are made in the
<a class="reference internal" href="../api/generated/larch.numba.Model.calculate_parameter_covariance.html#larch.numba.Model.calculate_parameter_covariance" title="larch.numba.Model.calculate_parameter_covariance"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">calculate_parameter_covariance</span></code></span></a>
method instead.  Once completed, things like t-statistics and standard
errors are available in the parameter frame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">calculate_parameter_covariance</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">pf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value</th>
      <th>initvalue</th>
      <th>nullvalue</th>
      <th>minimum</th>
      <th>maximum</th>
      <th>holdfast</th>
      <th>note</th>
      <th>best</th>
      <th>std_err</th>
      <th>t_stat</th>
      <th>robust_std_err</th>
      <th>robust_t_stat</th>
      <th>unconstrained_std_err</th>
      <th>unconstrained_t_stat</th>
      <th>constrained</th>
      <th>likelihood_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.020000</td>
      <td>-0.02</td>
      <td>-0.02</td>
      <td>-0.020</td>
      <td>-0.02</td>
      <td>1</td>
      <td></td>
      <td>-0.020000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>fixed value</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.015746</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
      <td>0.015746</td>
      <td>0.039390</td>
      <td>0.399756</td>
      <td>0.023284</td>
      <td>0.676282</td>
      <td>0.044789</td>
      <td>0.351566</td>
      <td></td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.036117</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>-100.000</td>
      <td>100.00</td>
      <td>0</td>
      <td></td>
      <td>0.036117</td>
      <td>0.042282</td>
      <td>0.854199</td>
      <td>0.048024</td>
      <td>0.752071</td>
      <td>0.048065</td>
      <td>0.751424</td>
      <td></td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.000000</td>
      <td>1.00</td>
      <td>1.00</td>
      <td>0.001</td>
      <td>1.00</td>
      <td>0</td>
      <td></td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.521577</td>
      <td>0.000000</td>
      <td>1.296339</td>
      <td>0.000000</td>
      <td>Mu_Motorized ≤ 1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.010000</td>
      <td>-0.01</td>
      <td>-0.01</td>
      <td>-0.010</td>
      <td>-0.01</td>
      <td>1</td>
      <td></td>
      <td>-0.010000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
      <td>fixed value</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="reporting">
<h2>Reporting<a class="headerlink" href="#reporting" title="Permalink to this headline">¶</a></h2>
<p>Larch includes a variety of pre-packaged and <em>a la carte</em> reporting options.</p>
<p>Commonly used report tables are available directly in a Jupyter notebook
through a selection of reporting functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">parameter_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_1db96 th {
  vertical-align: top;
  text-align: left;
}
#T_1db96 td {
  vertical-align: top;
  text-align: left;
}
#T_1db96_row0_col0, #T_1db96_row0_col1, #T_1db96_row0_col2, #T_1db96_row0_col3, #T_1db96_row0_col4, #T_1db96_row0_col5, #T_1db96_row1_col0, #T_1db96_row1_col1, #T_1db96_row1_col2, #T_1db96_row1_col3, #T_1db96_row1_col4, #T_1db96_row1_col5, #T_1db96_row2_col0, #T_1db96_row2_col1, #T_1db96_row2_col2, #T_1db96_row2_col3, #T_1db96_row2_col4, #T_1db96_row2_col5, #T_1db96_row3_col0, #T_1db96_row3_col1, #T_1db96_row3_col2, #T_1db96_row3_col3, #T_1db96_row3_col4, #T_1db96_row3_col5, #T_1db96_row4_col0, #T_1db96_row4_col1, #T_1db96_row4_col2, #T_1db96_row4_col3, #T_1db96_row4_col4, #T_1db96_row4_col5 {
  font-family: monospace;
}
</style>
<table id="T_1db96">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_1db96_level0_col0" class="col_heading level0 col0" >Value</th>
      <th id="T_1db96_level0_col1" class="col_heading level0 col1" >Std Err</th>
      <th id="T_1db96_level0_col2" class="col_heading level0 col2" >t Stat</th>
      <th id="T_1db96_level0_col3" class="col_heading level0 col3" >Signif</th>
      <th id="T_1db96_level0_col4" class="col_heading level0 col4" >Like Ratio</th>
      <th id="T_1db96_level0_col5" class="col_heading level0 col5" >Null Value</th>
      <th id="T_1db96_level0_col6" class="col_heading level0 col6" >Constrained</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1db96_level0_row0" class="row_heading level0 row0" >Cost</th>
      <td id="T_1db96_row0_col0" class="data row0 col0" >-0.0200</td>
      <td id="T_1db96_row0_col1" class="data row0 col1" > NA</td>
      <td id="T_1db96_row0_col2" class="data row0 col2" > NA</td>
      <td id="T_1db96_row0_col3" class="data row0 col3" ></td>
      <td id="T_1db96_row0_col4" class="data row0 col4" > NA</td>
      <td id="T_1db96_row0_col5" class="data row0 col5" >-0.02</td>
      <td id="T_1db96_row0_col6" class="data row0 col6" >fixed value</td>
    </tr>
    <tr>
      <th id="T_1db96_level0_row1" class="row_heading level0 row1" >Income_Bus</th>
      <td id="T_1db96_row1_col0" class="data row1 col0" > 0.0157</td>
      <td id="T_1db96_row1_col1" class="data row1 col1" > 0.0394</td>
      <td id="T_1db96_row1_col2" class="data row1 col2" > 0.40</td>
      <td id="T_1db96_row1_col3" class="data row1 col3" ></td>
      <td id="T_1db96_row1_col4" class="data row1 col4" > NA</td>
      <td id="T_1db96_row1_col5" class="data row1 col5" > 0.00</td>
      <td id="T_1db96_row1_col6" class="data row1 col6" ></td>
    </tr>
    <tr>
      <th id="T_1db96_level0_row2" class="row_heading level0 row2" >Income_Car</th>
      <td id="T_1db96_row2_col0" class="data row2 col0" > 0.0361</td>
      <td id="T_1db96_row2_col1" class="data row2 col1" > 0.0423</td>
      <td id="T_1db96_row2_col2" class="data row2 col2" > 0.85</td>
      <td id="T_1db96_row2_col3" class="data row2 col3" ></td>
      <td id="T_1db96_row2_col4" class="data row2 col4" > NA</td>
      <td id="T_1db96_row2_col5" class="data row2 col5" > 0.00</td>
      <td id="T_1db96_row2_col6" class="data row2 col6" ></td>
    </tr>
    <tr>
      <th id="T_1db96_level0_row3" class="row_heading level0 row3" >Mu_Motorized</th>
      <td id="T_1db96_row3_col0" class="data row3 col0" > 1.00</td>
      <td id="T_1db96_row3_col1" class="data row3 col1" > 0.00</td>
      <td id="T_1db96_row3_col2" class="data row3 col2" > NA</td>
      <td id="T_1db96_row3_col3" class="data row3 col3" >[]</td>
      <td id="T_1db96_row3_col4" class="data row3 col4" > 0.00</td>
      <td id="T_1db96_row3_col5" class="data row3 col5" > 1.00</td>
      <td id="T_1db96_row3_col6" class="data row3 col6" >Mu_Motorized ≤ 1.0</td>
    </tr>
    <tr>
      <th id="T_1db96_level0_row4" class="row_heading level0 row4" >Time</th>
      <td id="T_1db96_row4_col0" class="data row4 col0" >-0.0100</td>
      <td id="T_1db96_row4_col1" class="data row4 col1" > NA</td>
      <td id="T_1db96_row4_col2" class="data row4 col2" > NA</td>
      <td id="T_1db96_row4_col3" class="data row4 col3" ></td>
      <td id="T_1db96_row4_col4" class="data row4 col4" > NA</td>
      <td id="T_1db96_row4_col5" class="data row4 col5" >-0.01</td>
      <td id="T_1db96_row4_col6" class="data row4 col6" >fixed value</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">estimation_statistics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><table><thead><tr><th>Statistic</th><th>Aggregate</th><th>Per Case</th></tr><tr><td>Number of Cases</td><td colspan="2">4</td></tr><tr><td>Log Likelihood at Convergence</td><td>-3.75</td><td>-0.94</td></tr><tr><td>Log Likelihood at Null Parameters</td><td>-4.04</td><td>-1.01</td></tr><tr><td>Rho Squared w.r.t. Null Parameters</td><td colspan="2">0.072</td></tr></thead><tbody></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">most_recent_estimation_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><table style="margin-top:1px;"><tr><th>key</th><th style="text-align:left;">value</th></tr><tr><td>x</td><td style="text-align:left;"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>-0.020000</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>0.015746</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.036117</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>-0.010000</td>
    </tr>
  </tbody>
</table></td></tr><tr><td>loglike</td><td style="text-align:left;">-3.7482392442904424</td></tr><tr><td>d_loglike</td><td style="text-align:left;"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Cost</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Income_Bus</th>
      <td>-0.018819</td>
    </tr>
    <tr>
      <th>Income_Car</th>
      <td>0.012997</td>
    </tr>
    <tr>
      <th>Mu_Motorized</th>
      <td>0.433917</td>
    </tr>
    <tr>
      <th>Time</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table></td></tr><tr><td>nit</td><td style="text-align:left;">6</td></tr><tr><td>nfev</td><td style="text-align:left;">15</td></tr><tr><td>njev</td><td style="text-align:left;">6</td></tr><tr><td>status</td><td style="text-align:left;">0</td></tr><tr><td>message</td><td style="text-align:left;">'Optimization terminated successfully'</td></tr><tr><td>success</td><td style="text-align:left;">True</td></tr><tr><td>elapsed_time</td><td style="text-align:left;">0:00:00.024836</td></tr><tr><td>method</td><td style="text-align:left;">'slsqp'</td></tr><tr><td>n_cases</td><td style="text-align:left;">4</td></tr><tr><td>iteration_number</td><td style="text-align:left;">6</td></tr><tr><td>logloss</td><td style="text-align:left;">0.9370598110726106</td></tr></table></div></div></div>
</div>
<p>To save a model report to an Excel file, use the <a class="reference internal" href="../api/generated/larch.numba.Model.to_xlsx.html#larch.numba.Model.to_xlsx" title="larch.numba.Model.to_xlsx"><span class="xref myst py py-meth"><code class="docutils literal notranslate"><span class="pre">to_xlsx</span></code></span></a> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">to_xlsx</span><span class="p">(</span><span class="s2">&quot;/tmp/larch-demo.xlsx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/work/larch/larch/larch/larch/util/excel.py:523: FutureWarning: Use of **kwargs is deprecated, use engine_kwargs instead.
  xl = ExcelWriter(filename, engine=&#39;xlsxwriter_larch&#39;, model=model, **kwargs)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;larch.util.excel.ExcelWriter at 0x7f545439bbb0&gt;
</pre></div>
</div>
</div>
</div>
<p><img alt="" src="../_images/larch-demo-xlsx.jpg" /></p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./user-guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../installation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Installing Larch</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="data-fundamentals.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data for Discrete Choice</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jeffrey Newman<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>